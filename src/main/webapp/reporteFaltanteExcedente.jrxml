<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.20.5.final using JasperReports Library version 6.20.5-3efcf2e67f959db3888d79f73dde2dbd7acb4f8e  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reporteFaltanteExcedente" pageWidth="842" pageHeight="595" orientation="Landscape" columnWidth="802" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" uuid="6455208e-062f-45f9-b906-2427ccfd071c">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="DataAdapterLolfar.jrdax"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w1" value="0"/>
	<property name="com.jaspersoft.studio.data.sql.SQLQueryDesigner.sash.w2" value="1000"/>
	<style name="Crosstab_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CH" mode="Opaque" backcolor="#F0F8FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CG" mode="Opaque" backcolor="#BFE1FF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CT" mode="Opaque" backcolor="#005FB3">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<style name="Crosstab 1_CD" mode="Opaque" backcolor="#FFFFFF">
		<box>
			<pen lineWidth="0.5" lineColor="#000000"/>
			<topPen lineWidth="0.5" lineColor="#000000"/>
			<leftPen lineWidth="0.5" lineColor="#000000"/>
			<bottomPen lineWidth="0.5" lineColor="#000000"/>
			<rightPen lineWidth="0.5" lineColor="#000000"/>
		</box>
	</style>
	<parameter name="ordenini" class="java.lang.Integer"/>
	<parameter name="ordenfin" class="java.lang.Integer"/>
	<parameter name="SUBREPORT_DIR" class="java.lang.String"/>
	<parameter name="siscod" class="java.lang.String"/>
	<parameter name="fechaInicio" class="java.lang.String"/>
	<parameter name="fechaFin" class="java.lang.String"/>
	<queryString language="SQL">
		<![CDATA[select mov.*,p.despro,s.sisent,isnull(mov.cante,0)+(CAST(ISNULL(mov.cantf,0) AS DECIMAL(12, 5)) / p.stkfra)+isnull(r.cantidad,0) as calculo from 
(select d.invnum,d.numitm,d.codpro,m.codpicklist as ortrcod,o.feccre,d.siscod as siscod_d,isnull(sum(c.canter),0) - isnull(max(d.cante),0) as cante,isnull(sum(c.cantfr),0)-isnull(max(d.cantf),0) as cantf
from picking_cajas c inner join picking_detalle d on d.pickdetcod=c.pickdetcod
inner join picking m on m.pickcod=d.pickcod 
inner join pickinglist o on o.codpicklist=m.codpicklist
where d.chkcomrep='S' and ($P{ordenini} IS NULL  OR m.codpicklist >= $P{ordenini} )  and ($P{ordenfin} IS NULL  OR m.codpicklist <= $P{ordenfin} ) 
AND ( 
	 $P{fechaInicio} IS NULL  
	 OR o.feccre >= $P{fechaInicio}) 
	 AND ( 
	 $P{fechaFin} IS NULL  
	 OR o.feccre <= $P{fechaFin}) 
group by d.invnum,d.numitm,d.codpro,m.codpicklist,o.feccre,d.siscod) mov
inner join fa_productos p on mov.codpro=p.codpro
inner join sistema s on s.siscod =mov.siscod_d
left join reposicion_recepcion r on  r.codpro=p.codpro and r.orden=mov.ortrcod
and r.siscod=mov.siscod_d and r.estado='S' 
where isnull(mov.cante,0)+isnull(mov.cantf/p.stkfra,0)+isnull(r.cantidad,0)!=0
AND ( $P{siscod}  IS NULL OR mov.siscod_d= $P{siscod} )
union 
select calculo.*,s.sisent,isnull(calculo.cante,0)+isnull(calculo.cantf/pr.stkfra,0)
+isnull(r.cantidad,0) as calculo from (select '' as invnum,'' as numitm,e.codpro,e.orden,
(select top 1 o.feccre from pickinglist o
where e.orden=o.codpicklist) as feccre ,
(select top 1 m.siscod from picking_cajas c inner join picking_detalle m on m.pickdetcod=c.pickdetcod
where c.caja=e.caja) as siscod,
e.cante,e.cantf, p.despro from cajaextra e inner join fa_productos p on 
p.codpro=e.codpro where ($P{ordenini} IS NULL  
	 OR e.orden >= $P{ordenini} )  and ($P{ordenfin} IS NULL  OR e.orden <= $P{ordenfin} )
	 AND ( 
	 $P{fechaInicio} IS NULL  
	 OR (select top 1 o.feccre from pickinglist o where e.orden=o.codpicklist) >= 
	 $P{fechaInicio}) 
	 AND ( 
	 $P{fechaFin} IS NULL  
	 OR (select top 1 o.feccre from pickinglist o where e.orden=o.codpicklist) 
	 <= $P{fechaFin}) 
	   and e.estado='S') calculo
inner join sistema s on s.siscod=calculo.siscod
inner join fa_productos pr on calculo.codpro=pr.codpro
LEFT JOIN reposicion_recepcion r ON calculo.siscod=r.siscod and 
calculo.orden=r.orden and calculo.codpro=r.codpro and r.estado='S' 
where ( $P{siscod}  IS NULL OR calculo.siscod= $P{siscod} ) and 
isnull(calculo.cante,0)+isnull(calculo.cantf/pr.stkfra,0)!=0 and (r.estobs is null or r.estobsbot is null)
and (select top 1 d.chkcomrep from picking o inner join picking_detalle d on d.pickcod=o.pickcod where calculo.orden=o.codpicklist)='S']]>
	</queryString>
	<field name="invnum" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="invnum"/>
		<property name="com.jaspersoft.studio.field.label" value="invnum"/>
	</field>
	<field name="numitm" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="numitm"/>
		<property name="com.jaspersoft.studio.field.label" value="numitm"/>
	</field>
	<field name="codpro" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="codpro"/>
		<property name="com.jaspersoft.studio.field.label" value="codpro"/>
	</field>
	<field name="ortrcod" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="ortrcod"/>
		<property name="com.jaspersoft.studio.field.label" value="ortrcod"/>
	</field>
	<field name="feccre" class="java.sql.Timestamp">
		<property name="com.jaspersoft.studio.field.name" value="feccre"/>
		<property name="com.jaspersoft.studio.field.label" value="feccre"/>
	</field>
	<field name="siscod_d" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="siscod_d"/>
		<property name="com.jaspersoft.studio.field.label" value="siscod_d"/>
	</field>
	<field name="cante" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="cante"/>
		<property name="com.jaspersoft.studio.field.label" value="cante"/>
	</field>
	<field name="cantf" class="java.lang.Integer">
		<property name="com.jaspersoft.studio.field.name" value="cantf"/>
		<property name="com.jaspersoft.studio.field.label" value="cantf"/>
	</field>
	<field name="despro" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="despro"/>
		<property name="com.jaspersoft.studio.field.label" value="despro"/>
	</field>
	<field name="sisent" class="java.lang.String">
		<property name="com.jaspersoft.studio.field.name" value="sisent"/>
		<property name="com.jaspersoft.studio.field.label" value="sisent"/>
	</field>
	<field name="calculo" class="java.math.BigDecimal">
		<property name="com.jaspersoft.studio.field.name" value="calculo"/>
		<property name="com.jaspersoft.studio.field.label" value="calculo"/>
	</field>
	<variable name="calculo1" class="java.lang.Integer" calculation="Sum">
		<variableExpression><![CDATA[$F{calculo}]]></variableExpression>
	</variable>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="172" splitType="Stretch">
			<staticText>
				<reportElement x="170" y="20" width="410" height="30" uuid="912c0302-b2d0-40f7-84fb-7c54656cca5a"/>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="20"/>
				</textElement>
				<text><![CDATA[Reporte Productos Faltantes Excedentes Recepcion]]></text>
			</staticText>
			<staticText>
				<reportElement x="560" y="0" width="110" height="20" uuid="e710fd69-1e10-4cc0-9631-dd347d65b52a"/>
				<textElement textAlignment="Right">
					<font size="10" isBold="true"/>
				</textElement>
				<text><![CDATA[Fecha de ImpresiÃ³n:]]></text>
			</staticText>
			<textField pattern="dd/MM/yyyy">
				<reportElement x="670" y="0" width="130" height="20" uuid="c1b27b47-fc87-4dc7-9547-3bb0b47e6ed5"/>
				<textElement textAlignment="Left">
					<font size="10" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA[new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm:ss").format(new java.util.Date())]]></textFieldExpression>
			</textField>
			<subreport>
				<reportElement x="0" y="62" width="570" height="110" uuid="c94cf63f-47a0-4bf1-9b61-1c1f424d9149"/>
				<connectionExpression><![CDATA[$P{REPORT_CONNECTION}]]></connectionExpression>
				<subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "leyendaalmacenes.jasper"]]></subreportExpression>
			</subreport>
		</band>
	</title>
	<summary>
		<band height="139" splitType="Stretch">
			<crosstab>
				<reportElement x="10" y="0" width="800" height="139" isPrintWhenDetailOverflows="true" uuid="adfce212-bbfb-4776-9f01-489197c4e702">
					<property name="com.jaspersoft.studio.layout" value="com.jaspersoft.studio.editor.layout.VerticalRowLayout"/>
					<property name="com.jaspersoft.studio.crosstab.style.header" value="Crosstab 1_CH"/>
					<property name="com.jaspersoft.studio.crosstab.style.group" value="Crosstab 1_CG"/>
					<property name="com.jaspersoft.studio.crosstab.style.total" value="Crosstab 1_CT"/>
					<property name="com.jaspersoft.studio.crosstab.style.detail" value="Crosstab 1_CD"/>
				</reportElement>
				<rowGroup name="ortrcod" width="30" totalPosition="End">
					<bucket class="java.lang.Integer">
						<bucketExpression><![CDATA[$F{ortrcod}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CH">
							<textField textAdjust="ScaleFont">
								<reportElement x="0" y="0" width="30" height="60" uuid="b9316e54-6e7e-4679-b04c-4bca9271b288"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{ortrcod}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CT">
							<staticText>
								<reportElement x="0" y="0" width="270" height="20" forecolor="#FFFFFF" uuid="209df1af-7910-4e96-ae2d-442dc4ab058f"/>
								<text><![CDATA[Total]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="invnum" width="50" totalPosition="End">
					<bucket class="java.lang.Integer">
						<bucketExpression><![CDATA[$F{invnum}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CH">
							<textField textAdjust="ScaleFont">
								<reportElement x="0" y="0" width="50" height="40" uuid="acdaebda-722c-4703-a675-9cd83520c1a8"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{invnum}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CG">
							<staticText>
								<reportElement x="0" y="0" width="240" height="20" uuid="084a9755-3930-4a1d-b5ec-01472b5d89eb"/>
								<text><![CDATA[Total Orden]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<rowGroup name="despro" width="190" totalPosition="End">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{despro}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CH">
							<textField textAdjust="ScaleFont">
								<reportElement x="0" y="0" width="190" height="20" uuid="0fe30112-96c9-4ffd-8c59-1e32ec0eaf81"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{despro}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CG">
							<staticText>
								<reportElement x="0" y="0" width="190" height="20" uuid="9fd7c9c6-9b3f-4657-892b-ca45efb53fec"/>
								<text><![CDATA[Total Secuencia]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="siscod_d" height="20" totalPosition="End">
					<bucket class="java.lang.Integer">
						<bucketExpression><![CDATA[$F{siscod_d}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CH">
							<textField textAdjust="ScaleFont">
								<reportElement x="0" y="0" width="30" height="20" uuid="ac00cd04-23bb-4490-9377-62b52bbcb5aa"/>
								<textElement textAlignment="Center" verticalAlignment="Middle"/>
								<textFieldExpression><![CDATA[$V{siscod_d}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents mode="Opaque" style="Crosstab 1_CT">
							<staticText>
								<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="e3cc1955-c4fd-43df-92d9-0f55db8c5609"/>
								<text><![CDATA[Total siscod_d]]></text>
							</staticText>
						</cellContents>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="calculo_MEASURE" class="java.math.BigDecimal" calculation="Sum">
					<measureExpression><![CDATA[$F{calculo}]]></measureExpression>
				</measure>
				<crosstabCell width="30" height="20">
					<cellContents mode="Opaque" style="Crosstab 1_CD">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" uuid="ed5abfb8-4bec-443a-b5e3-53ae3f047e7e"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" columnTotalGroup="siscod_d">
					<cellContents mode="Opaque" style="Crosstab 1_CT">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="f60e0739-2ac9-49ee-80de-5f5b111ec6ef"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="ortrcod">
					<cellContents mode="Opaque" style="Crosstab 1_CT">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="c7a1967d-1df7-4799-bda0-53fa4761da51"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE_ortrcod_ALL}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="ortrcod" columnTotalGroup="siscod_d">
					<cellContents mode="Opaque" style="Crosstab 1_CT">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="908eb6f3-2ada-4dcc-acdb-4ab4332b7332"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="invnum">
					<cellContents mode="Opaque" style="Crosstab 1_CG">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" uuid="577bcca0-f3a6-47df-b4a0-bf1050b02812"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE_invnum_ALL}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="invnum" columnTotalGroup="siscod_d">
					<cellContents mode="Opaque" style="Crosstab 1_CT">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="4d81f8c8-2c6b-4dc6-a4e2-b52a4898448a"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="despro">
					<cellContents mode="Opaque" style="Crosstab 1_CG">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" uuid="69552b70-584b-4199-82f7-402828b97474"/>
							<textElement textAlignment="Center" verticalAlignment="Middle">
								<paragraph lineSpacingSize="1.0"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE_despro_ALL}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="30" height="20" rowTotalGroup="despro" columnTotalGroup="siscod_d">
					<cellContents mode="Opaque" style="Crosstab 1_CT">
						<textField textAdjust="ScaleFont">
							<reportElement x="0" y="0" width="30" height="20" forecolor="#FFFFFF" uuid="5b8cb616-e912-408b-b7d3-9cb219ee92e1"/>
							<textElement textAlignment="Center" verticalAlignment="Middle"/>
							<textFieldExpression><![CDATA[$V{calculo_MEASURE}.setScale(2, java.math.RoundingMode.HALF_UP).stripTrailingZeros()]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
			</crosstab>
		</band>
	</summary>
</jasperReport>
