<!-- Page Heading -->
<!--<h1 class="h3 mb-2 text-gray-800">Herramienta de Distribución</h1>-->
<style>
    .input-inline {
        display: flex;
        width: 125px !important;
    }
    .input-inline input {
        margin-right: 1px; /* Ajusta el margen según sea necesario */
        width: 60px;
    }
    .input-inline input:last-child {
        margin-right: 0;
    }
    .modal-backdrop {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5); /* Color semitransparente */
        z-index: 1040; /* z-index superior al modal */
    }
    .disabled-row {
        background-color: #e0e0e0 !important; /* Fondo más claro */
        color: #606060 !important; /* Texto más claro */
        pointer-events: none; /* Evita que el usuario interactúe con la fila */
        opacity: 0.6; /* Reduce la opacidad para hacer la fila parecer desactivada */
    }
    .inmovilizado-row {
        background-color: #BDBDBD !important; /* Fondo más claro */
        color: #606060 !important; /* Texto más claro */
        pointer-events: none; /* Evita que el usuario interactúe con la fila */
        opacity: 0.6; /* Reduce la opacidad para hacer la fila parecer desactivada */
    }
    .disabled-row td {
        pointer-events: none; /* Evita que el usuario interactúe con celdas */
    }
    .inmovilizado-row td {
        pointer-events: none; /* Evita que el usuario interactúe con celdas */
    }
    .danger-row {
        background-color: #FFB2B2 !important; /* Fondo más claro */
    }
    .min-row {
        background-color: #F9FFB2 !important; /* Fondo más claro */
    }
    .restri-row {
        background-color: #e0e0e0 !important; /* Fondo más claro */
    }
    .inmo-row {
        background-color: #BDBDBD !important; /* Fondo más claro */
    }
    .legend {
        position: fixed;
        top: 80px;
        right: 25px;
        background: #fff;
        border: 1px solid #ccc;
        padding: 5px;
        font-size: 12px;
        z-index: 1000;
        width: 400px;
    }
    .legend-item {
        display: flex;
        align-items: center;
        margin-bottom: 2px;
    }
    .color-box {
        width: 10px;
        height: 10px;
        margin-right: 5px;
    }
    .color-red {
        background-color: red;
    }
    .color-green {
        background-color: green;
    }
    .color-blue {
        background-color: blue;
    }
    #chart-container {
        display: flex;
        justify-content: center;
        align-items: center;
    }
    .containertext {
        display: flex;
    }
    .box {
        padding: 1px;
        margin: 1px;
    }
    .modal-dialog {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        margin: 0 auto;
    }
</style>
<!--<h1 class="h3 mb-2 text-gray-800">Distribución a almacenes</h1>-->
<div class="card shadow mb-4">   
    <div class="card-header py-3">
        <h6 class="m-0 font-weight-bold text-primary" id="titulo">Distribucion por DCI</h6>
    </div>
    <div class="card-body no-border">   
        <div class="d-flex flex-wrap justify-content-center justify-content-md-end mb-2">
            <button id="btnNuevaAlmacen" class="btn btn-primary mr-1 mb-1"><i class="fas fa-search-plus"></i>Reposicion por stock minimo</button>
            <!--<button id="btnNuevaPareto" class="btn btn-primary mr-1 mb-1"><i class="fas fa-search-plus"></i> Reposicion por porcentaje de stock</button>-->
            <button id="descargar" class="btn btn-primary mr-1 mb-1"><i class="fas fa-file-export"></i> Generar</button>
            <button id="btnLimpiarDatosModal" class="btn btn-primary mr-1 mb-1"><i class="fas fa-eraser"></i> Limpiar</button>
            <button id="atras" class="btn btn-success mr-1 mb-1" style="display:none">Atras</button>
        </div>
        <div class=" d-flex justify-content-end">
            <div class="form-check">
                <input type="checkbox" class="form-check-input" id="automatico" checked>
                <label class="form-check-label" for="automatico">Llenar distribucion automaticamente</label>
            </div>  
        </div>  
        <div class="row">
            <div class="col">
                <div id="contenedor-producto" style="display: none">
                    <div id="generico_titulo"></div>
                    <div class="table-responsive" style="position: relative; height: 620px;overflow-y: auto">
                        <table id="table-central" class="table table-striped table-bordered text-dark table-sm" style="width:100%;color:black">
                            <thead style="position: sticky;top: 0;z-index: 1;background-color: #fff;">
                                <tr>
                                    <th>Codalm </th>
                                    <th>Almacen</th>
                                    <th>StockAlm</th>
                                    <th>StockAlmF</th>
                                    <th>Venta Prom.</th>
                                    <th>Cobertura</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>

                        </table>

                        <div id="loadingcentral" style="display:none" >
                            <center><img src="img/loader.gif" alt="cargando"/><br/>Un momento, por favor...</center>
                        </div>
                    </div>
                </div>
                <div id="contenedor-generico" style="display: none">
                    <div class="table-responsive" style="position: relative; height: 620px;overflow-y: auto">
                        <table id="table-generico" class="table table-striped table-bordered text-dark table-sm" style="width:100%;color:black">
                            <thead style="position: sticky;top: 0;z-index: 1;background-color: #fff;">
                                <tr>
                                    <th>codigo</th>
                                    <th>Generico</th>
                                    <th>Stock</th>
                                    <th>Ventas</th>
                                    <th>Cobertura</th>
                                    <th>Acción</th>
                                </tr>
                            </thead>
                        </table>
                        <div id="loadingcentral" style="display:none" >
                            <center><img src="img/loader.gif" alt="cargando"/><br/>Un momento, por favor...</center>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- MODAL LIMPIAR -->
<div id="limpiarmodal" class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">¿Realmente desea limpiar los datos ingresados?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">×</span>
                </button>
            </div>
            <div class="modal-body">Al aceptar usted elimina todas las cantidades ingresadas para TODOS los productos.</div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" id="btnLimpiarDatos">Aceptar</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal -->
<div id="modal-distribucion" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h6 class="modal-title stkminimput" style="display: none;">Parametros de Distribucion para Estrategico y Genericos, reposicion de Stock Minimo</h6>
                <h6 class="modal-title repoimput" style="display: none;">Parametros de Distribucionn para Estrategico y Genericos, reposicion de venta</h6>
                <h6 class="modal-title paretoimput" style="display: none;">Parametros de Distribucion por Reposicion de Porcentaje de Stock</h6>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group stkminimput" style="display: none;">
                    <div class="row">
                        <div class="col-6">
                            <label for="selectStockMinimo">indicar cobertura en dias:</label>
                            <input type="number" class="form-control" id="selectStockMinimo" value=30>
                        </div>
                    </div>
                </div>
                <div class="form-group repoimput" style="display: none;">
                    <div class="row">
                        <div class="col-6">
                            <label for="selectStockMinimo2">indicar cobertura en dias:</label>
                            <input type="number" class="form-control" id="selectStockMinimo2" value=30>
                        </div>
                    </div>
                </div>
                <div class="form-group paretoimput" style="display: none;">
                    <div class="row">
                        <div class="col-auto">
                            <label style="padding-top: 5px;" for="selectStockMinimoPareto">Porcentaje de stock:</label>
                        </div>
                        <div class="col-auto">
                            <input style="width: 90px;" type="number" class="form-control" id="selectStockMinimoPareto" value=30>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-auto">

                            <p style="padding-top: 5px;">Que tipo de producto desea distribuir:</p>
                        </div>
                        <div class="col-auto">
                            <select class="form-control" id="generico">
                                <option value="estra">Farmaco Estrategico</option>
                                <option value="gen" selected>Generico No Estrategico</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <!--
                    <div class="form-check" id='divsolorojoscentral'>
                        <input class="form-check-input" type="checkbox"  id="solorojoscentral" checked>
                        <label class="form-check-label stkminimput" style="display: none;" for="solorojoscentral">Solo productos por debajo del stock minimo</label>
                        <label class="form-check-label repoimput" style="display: none;" for="solorojoscentral">Solo productos por debajo de la proyeccion de ventas</label>
                        <label class="form-check-label paretoimput" style="display: none;" for="solorojoscentral">Solo productos por debajo del porcentaje de stock</label>
                    </div>-->
                    <div class="row">
                        <div class="col-auto">
                            <p style="padding-top: 5px;">Productos a Distribuir:</p>
                        </div>
                        <div class="col-auto">
                            <select class="form-control" id="solorojosselect">
                                <option value="TODOS">Todos</option>
                                <option value="rojo" selected>Por debajo del stock minimo</option>
                            </select>
                        </div>
                    </div>
                </div>
                <!--<div class="form-group">
                    <div class="form-check" id="divsolo0central" style="display: none;">
                        <input type="checkbox" class="form-check-input" id="solo0">
                        <label class="form-check-label stkminimput" style="display: none;" for="solo0">Mostrar productos con stock minimo cero</label>
                        <label class="form-check-label repoimput" style="display: none;" for="solo0">Mostrar productos con ventas cero</label>
                        <label class="form-check-label paretoimput" style="display: none;" for="solo0">Mostrar productos con porcentaje de stock cero</label>
                    </div>
                </div>-->
                <div class="form-group">
                    <div class="row">
                        <div class="col-auto">
                            <p style="padding-top: 5px;">Almacenes a aplicar:</p>
                        </div>
                        <div class="col-auto">
                            <select class="form-control" id="selectalm">
                                <option value="TODOS">Todos</option>
                                <option value="ESTAB">Filtrar solo a</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" style="overflow-y: auto;display: none;" id="establecimientofiltroTable">
                        <table id="tableestablecimientofiltro" class="table table-striped table-bordered table-sm text-dark">
                            <thead>
                                <tr>
                                    <th>Establecimiento</th>
                                    <th>Mostrar</th>
                                </tr>
                            </thead>
                        </table>
                    </div>
                    <div class="form-group" style="display:none">
                        <div class="row">
                            <div class="col-auto">
                                <p style="padding-top: 5px;">Filtrar por:</p>
                            </div>
                            <div class="col-auto">
                                <select class="form-control" id="selectFiltro">
                                    <option value="TODOS">Todos</option>
                                    <option value="SECUENCIA">Secuencia de ingreso</option>
                                    <option value="TIPO">Tipo de producto</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group" id="secuenciaInput" style="display: none;">
                            <label for="inputSecuencia">Número de secuencia de ingreso:</label>
                            <input type="number" class="form-control" id="inputSecuencia">
                        </div>

                        <div class="form-group" style="overflow-y: auto;display: none;" id="tipoProductoTable">
                            <table id="tabletipos" class="table table-striped table-bordered table-sm text-dark">
                                <thead>
                                    <tr>
                                        <th>Codigo</th>
                                        <th>Tipo de producto</th>
                                        <th>Filtro</th>
                                    </tr>
                                </thead>
                            </table>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <button id="btnAceptar" type="button" class="btn btn-primary">Aceptar</button>
                    <!-- Puedes agregar más botones aquí -->
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal border" id="modaltablaproductos" style="display:none;position: fixed;width: 100%;height: 100%;">
    <div class="modal-content" style="position: absolute;top: 50%; left: 50%;transform: translate(-50%, -50%);width: 98%;height: 98%;border: 2px solid #333;border-radius: 10px;overflow-y: auto;">
        <div class="modal-header">
            <div id="datosproducto">

            </div>
            <button class="close" type="button" id="cerrarmodal">
                <span aria-hidden="true">×</span>
            </button>
        </div>      
        <div class="modal-body">

            <div class="row">
                <!--
                <div class="col-auto">
                    <table class="table table-sm"  style="color:black;font-size: 0.9rem;">
                        <thead>
                            <tr>
                                <th>Descripcion</th>
                                <th>Cantidad</th>
                            <tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Stock Minimo</td>
                                <td id="tab_stkmin2">0</td>
                            </tr>
                            <tr>
                                <td>Stock Actual</td>
                                <td id="ta_stkalm">0</td>
                            </tr>
                            <tr>
                                <td>Repone</td>
                                <td id="ta_repone">0</td>
                            </tr>
                        </tbody>
                    </table>
                </div>-->
                <div class="col-auto">
                    <div id="nombre-grafica">Unidades Vendidas</div>
                    <div id="chart-container2">
                        <canvas id="myAreaChart" width="800" height="80"></canvas>
                    </div>
                </div>
                <!--
            <div class="col-auto">
                <button class="btn btn-primary mb-1" type="button" id="total">TODOS</button><br>
                <button class="btn btn-primary" type="button" id="cerrarmodal2">Aceptar</button>
            </div>
                -->
                <div class="legend" style="align-self: end ">
                    <div class="legend-item">
                        <span class="color-box danger-row"></span> Lote que vence primero(toda la fila: falta poco para vencerse)
                    </div>
                    <div class="legend-item">
                        <span class="color-box min-row"></span>  Lote que vence posteriormente
                    </div>
                    <div class="legend-item">
                        <span class="color-box restri-row"></span>  Establecimiento Restringido
                    </div>
                    <div class="legend-item">
                        <span class="color-box inmo-row"></span>  Lote inmovilizado
                    </div>
                </div>
            </div>
            <!-- 
             <div id="predic">
                 Sig mes estimado, Prediccion:
             </div>
            -->
            <div class="form-check" id="divsolorojosestab">
                <input type="checkbox" class="form-check-input" id="solorojos">
                <label class="form-check-label" for="solorojos">Mostrar solo establecimientos desabastecidos</label>
            </div>  
            <!--
            <div class="form-check" id="divsolo0estab" style="display: none;">
                <input type="checkbox" class="form-check-input" id="solo0estab">
                <label class="form-check-label" for="solo0estab" id="texto0estab">Mostrar establecimientos con stock minimo cero</label>
            </div>-->
            <!--<div id="vista-table-establecimientos" style="display: none;">-->
            <div  class="table-responsive"  style="position: relative; height: 380px;overflow-y: auto">
                <table id="table-establecimientos" class="table table-bordered text-dark table-sm" style="color:black;" >
                    <thead  style="position: sticky;top: 0;z-index: 1;background-color: #fff;">
                        <tr>
                            <th>Establecimiento</th>
                            <th>Lote</th>
                            <th>Fech. Ven.</th>
                            <th>Cant.E.</th>
                            <th>Cant.F.</th>
                            <th>Stck.E</th>
                            <th>Stck.F</th>
                            <th id='stkmin2'>Prom.Ven.</th>
                            <th>Sugerido</th>
                            <th>Transi.</th>
                            <th>Distribución</th>
                        </tr>
                    </thead>
                    <tfoot  style="position: sticky;bottom:  0;z-index: 1;background-color: #fff;">
                        <tr>
                            <th>Totales:</th>
                            <th></th>
                            <th></th>
                            <th id="footlotE">0</th>
                            <th id="footlotF">0</th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th></th>
                            <th  class="containertext"><div id='footcantE' class="box"></div> - <div class="box" id='footcantF'></div></th>
                        </tr>
                    </tfoot>
                </table>
                <div id="loadingproductos" style="display:none" >
                    <center><img src="img/loader.gif" alt="cargando"/><br/>Un momento, por favor...</center>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="modal-grafica" class="modal fade" id="exampleModal" tabindex="1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content" style="border: 1px solid #333; border-radius: 10px; box-shadow: 0 16px 24px rgba(0, 0, 0, 0.6);">
            <div class="modal-header">
                <p id="nombre-grafica2">Grafica:</p>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div id="chart-container" style='width: 100%; height: 400px;'>
                    <canvas id="myAreaChart2" width="100" height="100"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="vendor/chart.js/Chart.js" type="text/javascript"></script>
<script src="js/distribucion_generico.js" type="text/javascript"></script>