<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <title>Consulta Pinpag CSV</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css" />
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" />
</head>
<body>
    <div class="container mt-4">
        <h3 class="mb-4">
            <i class="fas fa-search me-2"></i>Operaciones con Tarjeta PINPAD
        </h3>

        <form id="filtroForm" class="row g-3 mb-4">
            <div class="col-md-4">
                <label for="fechaInicio" class="form-label">Fecha de Proceso (Inicio)</label>
                <input type="date" class="form-control" id="fechaInicio" required />
            </div>
            <div class="col-md-4">
                <label for="fechaFin" class="form-label">Fecha de Proceso (Fin)</label>
                <input type="date" class="form-control" id="fechaFin" required />
            </div>
            <div class="col-md-4 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="fas fa-search me-2"></i>Buscar
                </button>
            </div>
        </form>

        <div id="loadingSpinner" class="text-center my-3" style="display:none;">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Cargando...</span>
            </div>
        </div>

        <div class="table-responsive">
            <table id="tablaPinpag" class="table table-striped table-bordered" style="width: 100%">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>CODIGO</th>
                        <th>PRODUCTO</th>
                        <th>TIPO MOV</th>
                        <th>FECHA PROCESO</th>
                        <th>FECHA LOTE</th>
                        <th>LOTE MANUAL</th>
                        <th>LOTE POS</th>
                        <th>TERMINAL</th>
                        <th>VOUCHER</th>
                        <th>AUTORIZACION</th>
                        <th>CUOTAS</th>
                        <th>TARJETA</th>
                        <th>ORIGEN</th>
                        <th>TRANSACCION</th>
                        <th>FECHA CONSUMO</th>
                        <th>IMPORTE</th>
                        <th>STATUS PINPAD</th>
                        <th>COMISION</th>
                        <th>COMISION AFECTA</th>
                        <th>IGV</th>
                        <th>NETO PARCIAL</th>
                        <th>NETO TOTAL</th>
                        <th>FECHA ABONO</th>
                        <th>FECHA ABONO 8DIG</th>
                    </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
    <script src="js/moment.min.js" type="text/javascript"></script>
    <script src="https://kit.fontawesome.com/7e7e2e2e2e.js" crossorigin="anonymous"></script>

    <script>
        $(document).ready(function () {
            let fechaActual = moment().format('YYYY-MM-DD');
            $("#fechaInicio").val(fechaActual);
            $("#fechaFin").val(fechaActual);

            let tabla = $("#tablaPinpag").DataTable({
                language: {
                    url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json"
                },
                dom: 'Bfrtip',
                buttons: [
                    {
                        extend: 'excelHtml5',
                        text: '<i class="fas fa-file-excel me-2"></i>Excel',
                        className: 'btn btn-success'
                    },
                    {
                        extend: 'pdfHtml5',
                        text: '<i class="fas fa-file-pdf me-2"></i>PDF',
                        className: 'btn btn-danger',
                        orientation: 'landscape',
                        pageSize: 'A4',
                        exportOptions: {
                            columns: ':visible'
                        },
                        customize: function (doc) {
                            doc.defaultStyle.fontSize = 8;
                        }
                    },
                    {
                        extend: 'print',
                        text: '<i class="fas fa-print me-2"></i>Imprimir',
                        className: 'btn btn-secondary',
                        exportOptions: {
                            columns: ':visible'
                        }
                    }
                ],
                columns: [
                    { data: "ID", defaultContent: "" },
                    { data: "Codigo", defaultContent: "" },
                    { data: "Producto", defaultContent: "" },
                    { data: "Tipo_Mov", defaultContent: "" },
                    { data: "Fecha_Proceso", defaultContent: "" },
                    { data: "Fecha_Lote", defaultContent: "" },
                    { data: "Lote_Manual", defaultContent: "" },
                    { data: "Lote_Pos", defaultContent: "" },
                    { data: "Terminal", defaultContent: "" },
                    { data: "Voucher", defaultContent: "" },
                    { data: "Autorizacion", defaultContent: "" },
                    { data: "Cuotas", defaultContent: "" },
                    { data: "Tarjeta", defaultContent: "" },
                    { data: "Origen", defaultContent: "" },
                    { data: "Transaccion", defaultContent: "" },
                    { data: "Fecha_Consumo", defaultContent: "" },
                    { data: "Importe", defaultContent: "" },
                    { data: "Status_Pinpad", defaultContent: "" },
                    { data: "Comision", defaultContent: "" },
                    { data: "Comision_Afecta", defaultContent: "" },
                    { data: "IGV", defaultContent: "" },
                    { data: "Neto_Parcial", defaultContent: "" },
                    { data: "Neto_Total", defaultContent: "" },
                    { data: "Fecha_Abono", defaultContent: "" },
                    { data: "Fecha_Abono_8Dig", defaultContent: "" }
                ],
                data: [],
                pageLength: 25,
                lengthMenu: [10, 25, 50, 100]
            });

            $("#fechaInicio").on("change", function () {
                let inicioVal = $(this).val();
                if (inicioVal) {
                    $("#fechaFin").val(inicioVal);
                    let maxFechaFin = moment(inicioVal).add(31, 'days').format('YYYY-MM-DD');
                    $("#fechaFin").attr("min", inicioVal);
                    $("#fechaFin").attr("max", maxFechaFin);
                }
            });

            $("#filtroForm").on("submit", function (e) {
                e.preventDefault();
                let fechaInicio = $("#fechaInicio").val();
                let fechaFin = $("#fechaFin").val();

                if (!fechaInicio || !fechaFin) {
                    alert("Debe seleccionar ambas fechas.");
                    return;
                }

                let diffDias = moment(fechaFin).diff(moment(fechaInicio), 'days');
                if (diffDias < 0) {
                    alert("La fecha fin no puede ser anterior a la fecha inicio.");
                    return;
                }
                if (diffDias > 31) {
                    alert("El rango no debe superar los 31 días.");
                    return;
                }

                $("#loadingSpinner").show();

                $.ajax({
                    url: "pinpad",
                    method: "POST",
                    contentType: "application/json",
                    data: JSON.stringify({ fechaInicio, fechaFin }),
                    success: function (response) {
                        tabla.clear().rows.add(response).draw();
                    },
                    error: function (xhr) {
                        alert("Error al consultar los datos");
                    },
                    complete: function () {
                        $("#loadingSpinner").hide();
                    }
                });
            });
        });
    </script>
</body>
</html>

<!--<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <title>Consulta Pinpag CSV</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            />
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/1.13.7/css/jquery.dataTables.min.css"
            />
        <link
            rel="stylesheet"
            href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css"
            />
    </head>
    <body>
        <div class="container mt-4">
            <h3 class="mb-4">
                <i class="fas fa-search me-2"></i>Operaciones con Tarjeta PINPAD
            </h3>
            <form id="filtroForm" class="row g-3 mb-4">
                <div class="col-md-4">
                    <label for="fechaInicio" class="form-label"
                           >Fecha de Proceso (Inicio)</label
                    >
                    <input type="date" class="form-control" id="fechaInicio" required />
                </div>
                <div class="col-md-4">
                    <label for="fechaFin" class="form-label"
                           >Fecha de Proceso (Fin)</label
                    >
                    <input type="date" class="form-control" id="fechaFin" required />
                </div>
                <div class="col-md-4 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="fas fa-search me-2"></i>Buscar
                    </button>
                </div>
            </form>

           
            <div id="loadingSpinner" class="text-center my-3" style="display:none;">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                </div>
            </div>


            <div class="table-responsive">
                <table
                    id="tablaPinpag"
                    class="table table-striped table-bordered"
                    style="width: 100%"
                    >
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>CODIGO</th>
                            <th>PRODUCTO</th>
                            <th>TIPO MOV</th>
                            <th>FECHA PROCESO</th>
                            <th>FECHA LOTE</th>
                            <th>LOTE MANUAL</th>
                            <th>LOTE POS</th>
                            <th>TERMINAL</th>
                            <th>VOUCHER</th>
                            <th>AUTORIZACION</th>
                            <th>CUOTAS</th>
                            <th>TARJETA</th>
                            <th>ORIGEN</th>
                            <th>TRANSACCION</th>
                            <th>FECHA CONSUMO</th>
                            <th>IMPORTE</th>
                            <th>STATUS PINPAD</th>
                            <th>COMISION</th>
                            <th>COMISION AFECTA</th>
                            <th>IGV</th>
                            <th>NETO PARCIAL</th>
                            <th>NETO TOTAL</th>
                            <th>FECHA ABONO</th>
                            <th>FECHA ABONO 8DIG</th>
                        </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>

        
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
        <script src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>
        <script src="js/moment.min.js" type="text/javascript"></script>
        <script
            src="https://kit.fontawesome.com/7e7e2e2e2e.js"
            crossorigin="anonymous"
        ></script>
       
        <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.2/css/buttons.bootstrap5.min.css" />
        <script src="https://cdn.datatables.net/buttons/2.4.2/js/dataTables.buttons.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.bootstrap5.min.js"></script>

        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
        <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.html5.min.js"></script>
        <script src="https://cdn.datatables.net/buttons/2.4.2/js/buttons.print.min.js"></script>

        <script>
            $(document).ready(function () {
                let fechaActual = moment().format('YYYY-MM-DD');

                $("#fechaInicio").val(fechaActual);
                $("#fechaFin").val(fechaActual);


                let tabla = $("#tablaPinpag").DataTable({
                    language: {
                        url: "//cdn.datatables.net/plug-ins/1.13.7/i18n/es-ES.json",
                    },
                    columns: [
                        {data: "ID", defaultContent: ""},
                        {data: "Codigo", defaultContent: ""},
                        {data: "Producto", defaultContent: ""},
                        {data: "Tipo_Mov", defaultContent: ""},
                        {data: "Fecha_Proceso", defaultContent: ""},
                        {data: "Fecha_Lote", defaultContent: ""},
                        {data: "Lote_Manual", defaultContent: ""},
                        {data: "Lote_Pos", defaultContent: ""},
                        {data: "Terminal", defaultContent: ""},
                        {data: "Voucher", defaultContent: ""},
                        {data: "Autorizacion", defaultContent: ""},
                        {data: "Cuotas", defaultContent: ""},
                        {data: "Tarjeta", defaultContent: ""},
                        {data: "Origen", defaultContent: ""},
                        {data: "Transaccion", defaultContent: ""},
                        {data: "Fecha_Consumo", defaultContent: ""},
                        {data: "Importe", defaultContent: ""},
                        {data: "Status_Pinpad", defaultContent: ""},
                        {data: "Comision", defaultContent: ""},
                        {data: "Comision_Afecta", defaultContent: ""},
                        {data: "IGV", defaultContent: ""},
                        {data: "Neto_Parcial", defaultContent: ""},
                        {data: "Neto_Total", defaultContent: ""},
                        {data: "Fecha_Abono", defaultContent: ""},
                        {data: "Fecha_Abono_8Dig", defaultContent: ""},
                    ],
                    data: [],
                });

                // Sincronizar fecha fin con inicio
                $("#fechaInicio").on("change", function () {
                    let inicioVal = $(this).val();
                    if (inicioVal) {
                        $("#fechaFin").val(inicioVal);
                        let maxFechaFin = moment(inicioVal).add(31, 'days').format('YYYY-MM-DD');
                        $("#fechaFin").attr("min", $("#fechaInicio").val());
                        $("#fechaFin").attr("max", maxFechaFin);
                    }
                });

                $("#filtroForm").on("submit", function (e) {
                    e.preventDefault();
                    let fechaInicio = $("#fechaInicio").val();
                    let fechaFin = $("#fechaFin").val();

                    if (!fechaInicio || !fechaFin) {
                        alert("Debe seleccionar ambas fechas.");
                        return;
                    }

                    let diffDias = moment(fechaFin).diff(moment(fechaInicio), 'days');
                    if (diffDias < 0) {
                        alert("La fecha fin no puede ser anterior a la fecha inicio.");
                        return;
                    }
                    if (diffDias > 31) {
                        alert("El rango no debe superar los 31 días.");
                        return;
                    }

                    $("#loadingSpinner").show();

                    $.ajax({
                        url: "pinpad", // Cambia esto por tu endpoint real
                        method: "POST",
                        contentType: "application/json",
                        data: JSON.stringify({fechaInicio, fechaFin}),
                        success: function (response) {
                            // Asume que response es un array de objetos con los campos de la tabla
                            tabla.clear().rows.add(response).draw();
                        },
                        error: function (xhr) {
                            alert("Error al consultar los datos");
                        },
                        complete: function () {
                            $("#loadingSpinner").hide();
                        }
                    });
                });
            });
        </script>
    </body>
</html>-->
