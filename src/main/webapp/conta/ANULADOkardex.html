<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generar Kardex</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="bg-white p-8 rounded-2xl shadow-lg w-full max-w-md">
        <h1 class="text-2xl font-bold text-center text-gray-800 mb-6">Generador de Kardex</h1>

        <div class="mb-4">
            <label for="anio" class="block text-gray-700 font-medium mb-2">Año:</label>
            <input type="number" id="anio" value="2025" class="w-full p-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>

        <div class="mb-4">
            <label for="mes" class="block text-gray-700 font-medium mb-2">Mes:</label>
            <input type="number" id="mes" value="2" min="1" max="12" class="w-full p-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>

        <div class="mb-4">
            <label for="codAlm" class="block text-gray-700 font-medium mb-2">Código de Almacén:</label>
            <input type="text" id="codAlm" value="01" class="w-full p-2 border rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400">
        </div>

        <button id="generarKardex" class="w-full bg-blue-500 text-white font-bold py-2 rounded-xl hover:bg-blue-600 transition duration-200">
            Generar Kardex
        </button>

        <div id="statusBar" class="hidden mt-6">
            <div class="flex items-center justify-between mb-2">
                <span class="text-gray-700">Procesando...</span>
                <span id="progressText" class="text-gray-500 text-sm">0%</span>
            </div>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div id="progressBar" class="bg-blue-500 h-4 rounded-full" style="width: 0%;"></div>
            </div>
        </div>

        <div id="message" class="mt-4 text-center text-gray-700 font-medium"></div>
    </div>

    <script>
        $(document).ready(function() {
            $('#generarKardex').click(function() {
                const anio = $('#anio').val();
                const mes = $('#mes').val();
                const codAlm = $('#codAlm').val();

                // Mostrar barra de progreso
                $('#statusBar').removeClass('hidden');
                $('#progressBar').css('width', '0%');
                $('#progressText').text('0%');
                $('#message').text('');

                // Simulación de progreso (para dar sensación de actividad)
                let progress = 0;
                const interval = setInterval(function() {
                    if (progress < 90) { // Simula hasta el 90% antes de completar
                        progress += 5;
                        $('#progressBar').css('width', progress + '%');
                        $('#progressText').text(progress + '%');
                    } else {
                        clearInterval(interval);
                    }
                }, 500);

                // Llamada AJAX
                $.ajax({
                    url: '../movimientoalmacen',
                    type: 'POST',
                    data: { anio, mes, codAlm },
                    success: function(response) {
                        clearInterval(interval);
                        $('#progressBar').css('width', '100%');
                        $('#progressText').text('100%');
                        $('#message').text('Datos insertados correctamente en el Kardex.').addClass('text-green-600');
                    },
                    error: function(xhr, status, error) {
                        clearInterval(interval);
                        $('#progressBar').css('width', '0%');
                        $('#progressText').text('0%');
                        $('#message').text('Error al insertar datos: ' + error).addClass('text-red-600');
                    }
                });
            });
        });
    </script>
</body>
</html>

